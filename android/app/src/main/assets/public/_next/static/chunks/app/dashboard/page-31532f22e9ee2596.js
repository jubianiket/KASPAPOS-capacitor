(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[105],{12648:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>E});var a=t(95155),s=t(12115),n=t(42099),l=t(66695),i=t(88390),o=t(94815),d=t(25299),c=t(83540),u=t(3401),m=t(96025),x=t(16238),f=t(94517),h=t(83394);function g(e){let{orders:r}=e,t=(0,s.useMemo)(()=>{let e={};return r.forEach(r=>{let t=new Date(r.created_at).toLocaleDateString("en-US",{month:"short",day:"numeric"});e[t]?e[t]+=r.total:e[t]=r.total}),Array.from({length:7}).map((e,r)=>{let t=new Date;return t.setDate(t.getDate()-r),t.toLocaleDateString("en-US",{month:"short",day:"numeric"})}).reverse().map(r=>({name:r,total:e[r]||0}))},[r]);return(0,a.jsx)(c.u,{width:"100%",height:350,children:(0,a.jsxs)(u.E,{data:t,children:[(0,a.jsx)(m.W,{dataKey:"name",stroke:"#888888",fontSize:12,tickLine:!1,axisLine:!1}),(0,a.jsx)(x.h,{stroke:"#888888",fontSize:12,tickLine:!1,axisLine:!1,tickFormatter:e=>"Rs.".concat(e)}),(0,a.jsx)(f.m,{cursor:{fill:"hsl(var(--muted))"},contentStyle:{backgroundColor:"hsl(var(--background))",borderColor:"hsl(var(--border))",borderRadius:"var(--radius)"}}),(0,a.jsx)(h.y,{dataKey:"total",fill:"hsl(var(--primary))",radius:[4,4,0,0]})]})})}var p=t(8782),j=t(34e3),_=t(54811),y=t(24026);let b=["#0088FE","#00C49F","#FFBB28","#FF8042","#8884d8"];function N(e){let{orders:r}=e,t=(0,s.useMemo)(()=>{let e={};return r.forEach(r=>{r.items.forEach(r=>{let t=r.category||"Uncategorized";e[t]?e[t]+=r.rate*r.quantity:e[t]=r.rate*r.quantity})}),Object.entries(e).map(e=>{let[r,t]=e;return{name:r,value:t}}).sort((e,r)=>r.value-e.value)},[r]);return(0,a.jsx)(c.u,{width:"100%",height:350,children:(0,a.jsxs)(p.r,{children:[(0,a.jsx)(j.F,{data:t,cx:"50%",cy:"50%",labelLine:!1,outerRadius:100,fill:"#8884d8",dataKey:"value",nameKey:"name",label:e=>{let{cx:r,cy:t,midAngle:s,innerRadius:n,outerRadius:l,percent:i,index:o}=e,d=n+(l-n)*.5,c=r+d*Math.cos(-(Math.PI/180*s)),u=t+d*Math.sin(-(Math.PI/180*s));return 100*i>5?(0,a.jsx)("text",{x:c,y:u,fill:"white",textAnchor:c>r?"start":"end",dominantBaseline:"central",children:"".concat((100*i).toFixed(0),"%")}):null},children:t.map((e,r)=>(0,a.jsx)(_.f,{fill:b[r%b.length]},"cell-".concat(r)))}),(0,a.jsx)(f.m,{cursor:{fill:"hsl(var(--muted))"},contentStyle:{backgroundColor:"hsl(var(--background))",borderColor:"hsl(var(--border))",borderRadius:"var(--radius)"},formatter:e=>"Rs.".concat(e.toFixed(2))}),(0,a.jsx)(y.s,{})]})})}var w=t(68856),v=t(35695);function E(){let[e,r]=(0,s.useState)([]),[t,c]=(0,s.useState)(!0),u=(0,v.useRouter)();(0,s.useEffect)(()=>{let e=async e=>{c(!0),r(await (0,n.NQ)(e)),c(!1)},t=localStorage.getItem("user");if(t){let r=JSON.parse(t);r.restaurant_id&&e(r.restaurant_id)}else u.replace("/login")},[u]);let m=(0,s.useMemo)(()=>{let r=e.reduce((e,r)=>e+r.total,0),t=e.length;return{totalRevenue:r,totalOrders:t,averageOrderValue:t>0?r/t:0}},[e]);return(0,a.jsxs)("div",{className:"container mx-auto p-4 md:p-6 lg:p-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold mb-6",children:"Dashboard"}),t?(0,a.jsx)(R,{}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[(0,a.jsxs)(l.Zp,{children:[(0,a.jsxs)(l.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(l.ZB,{className:"text-sm font-medium",children:"Total Revenue"}),(0,a.jsx)(i.A,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsxs)(l.Wu,{children:[(0,a.jsxs)("div",{className:"text-2xl font-bold",children:["Rs.",m.totalRevenue.toFixed(2)]}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground",children:["From ",m.totalOrders," orders"]})]})]}),(0,a.jsxs)(l.Zp,{children:[(0,a.jsxs)(l.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(l.ZB,{className:"text-sm font-medium",children:"Total Orders"}),(0,a.jsx)(o.A,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsxs)(l.Wu,{children:[(0,a.jsxs)("div",{className:"text-2xl font-bold",children:["+",m.totalOrders]}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Across all time"})]})]}),(0,a.jsxs)(l.Zp,{children:[(0,a.jsxs)(l.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(l.ZB,{className:"text-sm font-medium",children:"Average Order Value"}),(0,a.jsx)(d.A,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsxs)(l.Wu,{children:[(0,a.jsxs)("div",{className:"text-2xl font-bold",children:["Rs.",m.averageOrderValue.toFixed(2)]}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Per transaction"})]})]})]}),(0,a.jsxs)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-7",children:[(0,a.jsxs)(l.Zp,{className:"lg:col-span-4",children:[(0,a.jsx)(l.aR,{children:(0,a.jsx)(l.ZB,{children:"Sales Overview"})}),(0,a.jsx)(l.Wu,{className:"pl-2",children:(0,a.jsx)(g,{orders:e})})]}),(0,a.jsxs)(l.Zp,{className:"lg:col-span-3",children:[(0,a.jsx)(l.aR,{children:(0,a.jsx)(l.ZB,{children:"Popular Categories"})}),(0,a.jsx)(l.Wu,{children:(0,a.jsx)(N,{orders:e})})]})]})]})]})}let R=()=>(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[(0,a.jsx)(w.E,{className:"h-28"}),(0,a.jsx)(w.E,{className:"h-28"}),(0,a.jsx)(w.E,{className:"h-28"})]}),(0,a.jsxs)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-7",children:[(0,a.jsx)(w.E,{className:"lg:col-span-4 h-80"}),(0,a.jsx)(w.E,{className:"lg:col-span-3 h-80"})]})]})},42099:(e,r,t)=>{"use strict";t.d(r,{EB:()=>m,Hh:()=>h,Jv:()=>g,NQ:()=>u,Xx:()=>j,ax:()=>d,fr:()=>f,gL:()=>l,ic:()=>i,kf:()=>c,mt:()=>p,o8:()=>x,q2:()=>o});let a=(0,t(72354).UU)("https://iwfunipsnoqfasntaofl.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml3ZnVuaXBzbm9xZmFzbnRhb2ZsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA2NzU1MjQsImV4cCI6MjA2NjI1MTUyNH0.E2YU0wDS16TUsIbX8qIM3Xo6XZF3Z_GuWFUmjWw7Z7A"),s=e=>{var r,t,a;return e?{id:e.id,created_at:e.date,items:Array.isArray(e.items)?e.items:[],subtotal:null!=(r=e.sub_total)?r:0,tax:null!=(t=e.gst)?t:0,total:null!=(a=e.total)?a:0,payment_method:e.payment_method,payment_status:e.payment_status,order_type:e.order_type,table_number:e.table_number,status:e.status,phone_no:e.phone_no,flat_no:e.flat_no,building_no:e.building_no,address:e.address,restaurant_id:e.restaurant_id}:e},n=e=>{var r;let t={date:e.created_at||new Date().toISOString(),items:e.items,sub_total:e.subtotal,gst:e.tax,total:e.total,order_type:e.order_type,table_number:e.table_number,payment_method:e.payment_method,payment_status:null!=(r=e.payment_status)?r:"unpaid",status:e.status,phone_no:e.phone_no,flat_no:e.flat_no,building_no:e.building_no,address:e.address,restaurant_id:e.restaurant_id};return e.id>0&&(t.id=e.id),t},l=async e=>{let{data:r,error:t}=await a.from("menu_items").select("*").eq("restaurant_id",e).order("name");return t?(console.error("Error fetching menu items:",t),[]):(r||[]).map(r=>({...r,rate:Number(r.rate),restaurant_id:e}))},i=async e=>{let{data:r,error:t}=await a.from("menu_items").insert(e).select().single();return t?(console.error("Error adding menu item:",t),null):r},o=async(e,r,t)=>{let{data:s,error:n}=await a.from("menu_items").update(t).match({id:e,restaurant_id:r}).select().single();return n?(console.error("Error updating menu item:",n),null):s},d=async(e,r)=>{let{error:t}=await a.from("menu_items").delete().match({id:e,restaurant_id:r});return!t||(console.error("Error deleting menu item:",t),!1)},c=async e=>{let{data:r,error:t}=await a.from("orders").select("*").eq("restaurant_id",e).neq("payment_status","paid").order("date",{ascending:!1});return t?(console.error("Error fetching active orders:",t),[]):r.map(s)},u=async e=>{let{data:r,error:t}=await a.from("orders").select("*").eq("restaurant_id",e).eq("payment_status","paid").order("date",{ascending:!1});return t?(console.error("Error fetching completed orders:",t),[]):r.map(s)},m=async e=>{if("pending"===e.status)return e;if(e.id<=0){let{id:r,...t}=n(e),{data:l,error:i}=await a.from("orders").insert(t).select().single();return i?(console.error("Error inserting order:",i),null):s(l)}{let r=n(e),{data:t,error:l}=await a.from("orders").update(r).match({id:e.id,restaurant_id:e.restaurant_id}).select().single();return l?(console.error("Error updating order:",l),null):s(t)}},x=async(e,r)=>{let{error:t}=await a.from("orders").delete().match({id:e,restaurant_id:r});return!t||(console.error("Error deleting order:",t),!1)},f=async e=>{if(!e.id||e.id<0)return console.error("Cannot create kitchen order without a valid main order ID."),null;let r={order_id:e.id,items:e.items,order_type:e.order_type,table_number:e.table_number,status:"preparing",restaurant_id:e.restaurant_id},{data:t,error:s}=await a.from("kitchen_orders").insert(r).select().single();return s?(console.error("Error creating kitchen order:",s),null):t},h=async(e,r,t)=>{let{data:s,error:n}=await a.from("users").select("id").or("email.eq.".concat(e,",username.eq.").concat(t.username)).maybeSingle();if(n&&"PGRST116"!==n.code)return console.error("Error checking for existing user:",n),null;if(s)return null;let{data:l,error:i}=await a.from("restaurants").insert({restaurant_name:"".concat(t.name,"'s Restaurant")}).select("id").single();if(i||!l)return console.error("Error creating restaurant:",i),null;let o={...t,email:e,password:r,role:"admin",restaurant_id:l.id},{data:d,error:c}=await a.from("users").insert(o).select().single();return c||!d?(console.error("Error creating user:",c),await a.from("restaurants").delete().eq("id",l.id),null):d},g=async(e,r)=>{let t=!isNaN(Number(e)),s="email.eq.".concat(e,",username.eq.").concat(e);t&&(s+=",phone.eq.".concat(Number(e)));let{data:n,error:l}=await a.from("users").select("*").or(s).single();if(l&&"PGRST116"!==l.code)return console.error("Error fetching user:",l),null;if(!n||n.password!==r)return null;let{data:i,error:o}=await a.from("users").select("*").eq("id",n.id).single();if(o||!i)return console.error("Could not re-fetch user after sign-in",o),null;let{password:d,...c}=i;return c},p=async e=>{let{data:r,error:t}=await a.from("restaurants").select("*").eq("id",e).maybeSingle();return t?(console.error("[getSettings] Error fetching settings:",t),null):r},j=async(e,r)=>{let{id:t,...s}=r,{data:n,error:l}=await a.from("restaurants").update(s).eq("id",e).select().single();return l?(console.error("[updateSettings] Error from Supabase:",l),null):n}},44680:(e,r,t)=>{Promise.resolve().then(t.bind(t,12648))},59434:(e,r,t)=>{"use strict";t.d(r,{cn:()=>n});var a=t(52596),s=t(39688);function n(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return(0,s.QP)((0,a.$)(r))}},66695:(e,r,t)=>{"use strict";t.d(r,{BT:()=>d,Wu:()=>c,ZB:()=>o,Zp:()=>l,aR:()=>i,wL:()=>u});var a=t(95155),s=t(12115),n=t(59434);let l=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)("div",{ref:r,className:(0,n.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",t),...s})});l.displayName="Card";let i=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)("div",{ref:r,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",t),...s})});i.displayName="CardHeader";let o=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)("h3",{ref:r,className:(0,n.cn)("text-2xl font-semibold leading-none tracking-tight",t),...s})});o.displayName="CardTitle";let d=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)("p",{ref:r,className:(0,n.cn)("text-sm text-muted-foreground",t),...s})});d.displayName="CardDescription";let c=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)("div",{ref:r,className:(0,n.cn)("p-6 pt-0",t),...s})});c.displayName="CardContent";let u=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)("div",{ref:r,className:(0,n.cn)("flex items-center p-6 pt-0",t),...s})});u.displayName="CardFooter"},68856:(e,r,t)=>{"use strict";t.d(r,{E:()=>n});var a=t(95155),s=t(59434);function n(e){let{className:r,...t}=e;return(0,a.jsx)("div",{className:(0,s.cn)("animate-pulse rounded-md bg-muted",r),...t})}}},e=>{var r=r=>e(e.s=r);e.O(0,[908,888,441,684,358],()=>r(44680)),_N_E=e.O()}]);