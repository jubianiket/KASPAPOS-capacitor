(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{181:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>ei});var a=t(95155),l=t(12115),i=t(35695),n=t(73672),r=t(77223),d=t(15121),c=t(78071),o=t(62011),m=t(34301),x=t(30285),h=t(66695),u=t(22346),p=t(89051),j=t(59434);let f=l.forwardRef((e,s)=>{let{className:t,children:l,...i}=e;return(0,a.jsxs)(p.bL,{ref:s,className:(0,j.cn)("relative overflow-hidden",t),...i,children:[(0,a.jsx)(p.LM,{className:"h-full w-full rounded-[inherit]",children:l}),(0,a.jsx)(g,{}),(0,a.jsx)(p.OK,{})]})});f.displayName=p.bL.displayName;let g=l.forwardRef((e,s)=>{let{className:t,orientation:l="vertical",...i}=e;return(0,a.jsx)(p.VM,{ref:s,orientation:l,className:(0,j.cn)("flex touch-none select-none transition-colors","vertical"===l&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===l&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",t),...i,children:(0,a.jsx)(p.lr,{className:"relative flex-1 rounded-full bg-border"})})});g.displayName=p.VM.displayName;var v=t(88390),y=t(6160),N=t(95633),b=t(8376),w=t(54165),_=t(17828),C=t(7390),S=t(18018),A=t(87481),O=t(66766),k=t(78064),P=t(9699);function R(e){let{order:s,settings:t}=e,{toast:i}=(0,A.dj)(),n=(0,l.useRef)(null),r=async()=>{if(!n.current)return void i({variant:"destructive",title:"Error",description:"Could not generate bill image."});try{let e=await k.$E(n.current,{cacheBust:!0,quality:.95,backgroundColor:"white"});await P.S.share({title:"Bill for Order #".concat(s.id),text:"Here is your bill for Order #".concat(s.id,". Total: Rs.").concat(s.total.toFixed(2)),url:e,dialogTitle:"Share Bill"})}catch(e){console.error("Error sharing bill image:",e),e instanceof Error&&e.message.includes("not implemented")?i({variant:"destructive",title:"Sharing Not Supported",description:"Sharing is only available on the mobile app."}):i({variant:"destructive",title:"Sharing Failed",description:"Could not share the bill image."})}};return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("div",{id:"receipt-container",children:(0,a.jsxs)("div",{ref:n,className:"text-sm p-4 bg-background text-black",children:[(0,a.jsxs)("div",{className:"text-center mb-4",children:[(0,a.jsx)("h3",{className:"text-lg font-bold",children:(null==t?void 0:t.restaurant_name)||"KASPA POS"}),(0,a.jsx)("p",{className:"text-xs text-gray-600",children:"Receipt"})]}),(null==t?void 0:t.qr_code_url)&&"delivery"===s.order_type&&(0,a.jsxs)("div",{className:"flex flex-col items-center gap-2 my-4",children:[(0,a.jsx)("p",{className:"text-sm font-medium",children:"Scan to Pay"}),(0,a.jsx)("div",{className:"p-2 border rounded-md bg-white",children:(0,a.jsx)(O.default,{src:t.qr_code_url,alt:"Payment QR Code",width:150,height:150,"data-ai-hint":"QR code"})})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Order ID:"})," ",s.id]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Date:"})," ",(e=>{let s=new Date(e);return"".concat(s.toLocaleDateString()," ").concat(s.toLocaleTimeString())})(s.created_at)]}),"dine-in"===s.order_type&&(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Table:"})," ",s.table_number]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Type:"})," ",(0,a.jsx)("span",{className:"capitalize",children:s.order_type})]})]}),"delivery"===s.order_type&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(u.w,{className:"my-2"}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("h4",{className:"font-semibold",children:"Delivery To:"}),(0,a.jsx)("p",{children:s.phone_no}),(0,a.jsx)("p",{children:[s.flat_no,s.building_no,s.address].filter(Boolean).join(", ")})]})]}),(0,a.jsx)(u.w,{className:"my-2"}),(0,a.jsx)("div",{children:s.items.map(e=>(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{children:e.name}),(0,a.jsxs)("p",{className:"text-xs text-gray-600",children:["(",e.quantity," x Rs.",e.rate.toFixed(2),")"]})]}),(0,a.jsxs)("p",{children:["Rs.",(e.quantity*e.rate).toFixed(2)]})]},e.id))}),(0,a.jsx)(u.w,{className:"my-2"}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"Subtotal"}),(0,a.jsxs)("span",{children:["Rs.",s.subtotal.toFixed(2)]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"Tax"}),(0,a.jsxs)("span",{children:["Rs.",s.tax.toFixed(2)]})]}),(0,a.jsxs)("div",{className:"flex justify-between font-bold text-base",children:[(0,a.jsx)("span",{children:"Total"}),(0,a.jsxs)("span",{children:["Rs.",s.total.toFixed(2)]})]})]}),(0,a.jsx)(u.w,{className:"my-2"}),(0,a.jsxs)("div",{className:"text-center",children:["delivery"===s.order_type?(0,a.jsxs)("div",{className:"space-y-1 text-xs",children:[(0,a.jsx)("p",{children:(0,a.jsx)("strong",{children:"To be paid by Cash/UPI."})}),(0,a.jsx)("p",{className:"text-gray-600",children:"Please share a screenshot of the payment on WhatsApp."})]}):s.payment_method&&(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Paid via:"})," ",s.payment_method]}),(0,a.jsx)("p",{className:"text-xs text-gray-600 mt-2",children:"Thank you for your visit!"})]})]})}),(0,a.jsxs)("div",{className:"flex justify-end gap-2 mt-4",children:[(0,a.jsxs)(x.$,{variant:"outline",size:"sm",onClick:r,children:[(0,a.jsx)(C.A,{className:"mr-2 h-4 w-4"})," Share"]}),(0,a.jsxs)(x.$,{variant:"outline",size:"sm",onClick:()=>{let e=n.current;if(e){let s=window.open("","","height=600,width=800");null==s||s.document.write("<html><head><title>Print Bill</title>"),null==s||s.document.write("\n                <style>\n                    body { font-family: sans-serif; margin: 20px; color: black !important; }\n                    .receipt { border: 1px solid #ccc; padding: 15px; width: 300px; margin: 0 auto; background-color: white; color: black; }\n                    .receipt * { color: black !important; }\n                    .header { text-align: center; }\n                    .items-table { width: 100%; border-collapse: collapse; }\n                    .items-table th, .items-table td { padding: 5px; text-align: left; }\n                    .totals { margin-top: 15px; }\n                    .totals div { display: flex; justify-content: space-between; }\n                </style>\n            "),null==s||s.document.write("</head><body>"),null==s||s.document.write(e.innerHTML),null==s||s.document.write("</body></html>"),null==s||s.document.close(),null==s||s.focus(),null==s||s.print()}},children:[(0,a.jsx)(S.A,{className:"mr-2 h-4 w-4"})," Print"]})]})]})}function F(e){let{children:s,total:t,onCompleteOrder:i,disabled:n=!1,order:r,onNewOrder:d,settings:c}=e,[o,m]=(0,l.useState)(""),[h,u]=(0,l.useState)(!1),[p,j]=(0,l.useState)("payment"),[f,g]=(0,l.useState)(null),[C,S]=(0,l.useState)(!1),A=async()=>{if(o){S(!0);let e=await i(o);S(!1),e?(g(e),j("receipt")):u(!1)}};return(0,a.jsxs)(w.lG,{open:h,onOpenChange:e=>{n||C||(u(e),e||"receipt"!==p||d(),setTimeout(()=>{j("payment"),m(""),g(null)},200))},children:[(0,a.jsx)(w.zM,{asChild:!0,disabled:n,children:s}),(0,a.jsxs)(w.Cf,{className:"sm:max-w-[425px]",children:["payment"===p&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(w.c7,{children:[(0,a.jsx)(w.L3,{children:"Complete Payment"}),(0,a.jsx)(w.rr,{children:"Select a payment method to finalize the order."})]}),(0,a.jsxs)("div",{className:"py-4 space-y-6",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Total Amount Due"}),(0,a.jsxs)("p",{className:"text-4xl font-bold text-primary",children:["Rs.",t.toFixed(2)]})]}),(null==c?void 0:c.qr_code_url)&&(null==r?void 0:r.order_type)==="delivery"&&(0,a.jsxs)("div",{className:"flex flex-col items-center gap-2",children:[(0,a.jsx)("p",{className:"text-sm font-medium",children:"Scan to Pay"}),(0,a.jsx)("div",{className:"p-2 border rounded-md bg-white",children:(0,a.jsx)(O.default,{src:c.qr_code_url,alt:"Payment QR Code",width:200,height:200,"data-ai-hint":"QR code"})})]}),(0,a.jsx)("div",{className:"flex justify-center",children:(0,a.jsxs)(_.O,{type:"single",variant:"outline",value:o,onValueChange:e=>{e&&m(e)},children:[(0,a.jsxs)(_.d,{value:"Cash","aria-label":"Pay with cash",children:[(0,a.jsx)(v.A,{className:"h-5 w-5 mr-2"}),"Cash"]}),(0,a.jsxs)(_.d,{value:"Card","aria-label":"Pay with card",children:[(0,a.jsx)(y.A,{className:"h-5 w-5 mr-2"}),"Card"]}),(0,a.jsxs)(_.d,{value:"Mobile","aria-label":"Pay with mobile",children:[(0,a.jsx)(N.A,{className:"h-5 w-5 mr-2"}),"Mobile"]})]})})]}),(0,a.jsxs)(w.Es,{children:[(0,a.jsx)(x.$,{variant:"outline",onClick:()=>u(!1),children:"Cancel"}),(0,a.jsx)(x.$,{onClick:A,disabled:!o||C,children:C?"Processing...":"Confirm Payment - Rs.".concat(t.toFixed(2))})]})]}),"receipt"===p&&f&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(w.c7,{children:[(0,a.jsxs)(w.L3,{className:"flex items-center gap-2",children:[(0,a.jsx)(b.A,{className:"h-6 w-6 text-green-500"}),(0,a.jsx)("span",{children:"Payment Successful"})]}),(0,a.jsx)(w.rr,{children:"The order has been completed. You can print the bill or start a new order."})]}),(0,a.jsx)("div",{className:"py-4",id:"receipt-section",children:(0,a.jsx)(R,{order:f,settings:c})}),(0,a.jsx)(w.Es,{className:"sm:justify-between gap-2",children:(0,a.jsx)(x.$,{onClick:()=>{u(!1)},variant:"secondary",children:"Start New Order"})})]})]})]})}var T=t(26126);function E(e){var s;let{order:t,settings:i,onUpdateQuantity:p,onRemoveItem:j,onClearOrder:g,onCompleteOrder:v,onConfirmOrder:y,onNewOrder:N}=e,b=null!=(s=null==t?void 0:t.items)?s:[],{subtotal:w,tax:_,total:C,taxBreakdown:S}=(0,l.useMemo)(()=>{let e=b.reduce((e,s)=>e+s.rate*s.quantity,0),s=0,t=[];if(null==i?void 0:i.tax_enabled){if(i.is_restaurant){if(i.cgst){let a=e*(i.cgst/100);s+=a,t.push({name:"CGST (".concat(i.cgst,"%)"),amount:a})}if(i.igst){let a=e*(i.igst/100);s+=a,t.push({name:"IGST (".concat(i.igst,"%)"),amount:a})}}if(i.is_bar&&i.vat){let a=e*(i.vat/100);s+=a,t.push({name:"VAT (".concat(i.vat,"%)"),amount:a})}}let a=e+s;return{subtotal:e,tax:s,total:a,taxBreakdown:t}},[b,i]),A=async e=>{if(t){let s={...t,subtotal:w,tax:_,total:C,payment_method:e,payment_status:"paid",status:"completed"};return await v(s)}},O=()=>!t||"paid"===t.payment_status||"received"!==t.status||0===t.items.length,k=()=>!t||"pending"!==t.status||0===t.items.length;return(0,a.jsxs)(h.Zp,{className:"sticky top-24",children:[(0,a.jsxs)(h.aR,{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)(h.ZB,{children:t?"delivery"===t.order_type?t.id<0?"New Delivery Order":"Delivery Order #".concat(t.id.toString().slice(-4)):t.table_number?"Order for Table ".concat(t.table_number):"Select a Table":"New Order"}),b.length>0&&"paid"!==t.payment_status&&(0,a.jsxs)(x.$,{variant:"ghost",size:"icon",onClick:g,className:"text-muted-foreground hover:text-destructive",children:[(0,a.jsx)(r.A,{className:"h-5 w-5"}),(0,a.jsx)("span",{className:"sr-only",children:"Clear Order"})]})]}),t&&(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:["dine-in"===t.order_type?(0,a.jsx)(d.A,{className:"h-4 w-4"}):(0,a.jsx)(c.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"capitalize",children:t.order_type}),"dine-in"===t.order_type&&t.table_number&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(u.w,{orientation:"vertical",className:"h-4"}),(0,a.jsxs)("span",{children:["Table: ",(0,a.jsx)("span",{className:"font-semibold text-foreground",children:t.table_number})]})]}),t.status&&(0,a.jsx)(T.E,{variant:"pending"===t.status?"outline":"secondary",className:"capitalize",children:t.status})]})]}),(0,a.jsx)(h.Wu,{children:0===b.length?(0,a.jsxs)("div",{className:"text-center text-muted-foreground py-16",children:[(0,a.jsx)("p",{children:t?"This order is empty.":"Select a table or delivery to start."}),(0,a.jsx)("p",{className:"text-sm",children:"Click on menu items to add them."})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(f,{className:"h-64 pr-4",children:(0,a.jsx)("div",{className:"space-y-4",children:b.map((e,s)=>(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)("div",{className:"flex-grow",children:[(0,a.jsx)("p",{className:"font-medium",children:e.name}),e.portion&&(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:e.portion})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(x.$,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>p(e.id,e.portion,e.quantity-1),disabled:"paid"===t.payment_status,children:(0,a.jsx)(o.A,{className:"w-4 h-4"})}),(0,a.jsx)("span",{className:"font-bold w-4 text-center",children:e.quantity}),(0,a.jsx)(x.$,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>p(e.id,e.portion,e.quantity+1),disabled:"paid"===t.payment_status,children:(0,a.jsx)(m.A,{className:"w-4 h-4"})}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground w-12 text-right",children:["Rs.",(e.rate*e.quantity).toFixed(2)]}),(0,a.jsx)(x.$,{variant:"ghost",size:"icon",className:"h-7 w-7 text-muted-foreground hover:text-destructive",onClick:()=>j(e.id,e.portion),disabled:"paid"===t.payment_status,children:(0,a.jsx)(r.A,{className:"w-4 h-4"})})]})]},"".concat(e.id,"-").concat(e.portion,"-").concat(s)))})}),(0,a.jsx)(u.w,{className:"my-4"}),(0,a.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"Subtotal"}),(0,a.jsxs)("span",{children:["Rs.",w.toFixed(2)]})]}),S.map(e=>(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:e.name}),(0,a.jsxs)("span",{children:["Rs.",e.amount.toFixed(2)]})]},e.name)),(0,a.jsx)(u.w,{className:"my-2"}),(0,a.jsxs)("div",{className:"flex justify-between font-bold text-base",children:[(0,a.jsx)("span",{children:"Total"}),(0,a.jsxs)("span",{children:["Rs.",C.toFixed(2)]})]})]})]})}),b.length>0&&(0,a.jsx)(h.wL,{className:"flex flex-col gap-2",children:(()=>{if(!t||0===t.items.length)return null;if("paid"===t.payment_status)return(0,a.jsx)(x.$,{className:"w-full",onClick:N,children:"Start New Order"});switch(t.status){case"pending":return(0,a.jsxs)(x.$,{className:"w-full text-lg py-6",onClick:y,disabled:k(),children:[(0,a.jsx)(n.A,{className:"mr-2 h-5 w-5"}),"Confirm Order"]});case"received":return(0,a.jsx)(F,{order:t,total:C,onCompleteOrder:A,disabled:O(),onNewOrder:N,settings:i,children:(0,a.jsx)(x.$,{className:"w-full text-lg py-6",disabled:O(),children:"Proceed to Payment"})});default:return null}})()})]})}var D=t(18046);function I(e){let{item:s,onAddToOrder:t}=e,[i,n]=(0,l.useState)(!1),[r,d]=(0,l.useState)(s.baseRate),{toast:c}=(0,A.dj)();return(0,a.jsxs)(h.Zp,{className:"flex flex-col overflow-hidden transition-all duration-300 hover:shadow-lg hover:-translate-y-1 cursor-pointer",onClick:e=>{e.preventDefault(),t(s)},children:[(0,a.jsx)(h.Wu,{className:"p-4 flex-grow",children:(0,a.jsx)(h.ZB,{className:"text-base font-semibold mb-1",children:s.name})}),(0,a.jsxs)(h.wL,{className:"p-4 pt-0 flex justify-between items-center",children:[(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsxs)("p",{className:"text-lg font-bold text-primary",children:["Rs.",Number(s.baseRate).toFixed(2)]})}),(0,a.jsx)(x.$,{size:"icon",variant:"outline","aria-label":"Add ".concat(s.name," to order"),children:(0,a.jsx)(D.A,{className:"h-5 w-5"})})]})]})}var q=t(68856),$=t(965),M=t(73158),L=t(22924);function z(e){let{isOpen:s,onOpenChange:t,itemName:i,portions:n,onConfirm:r}=e,[d,c]=(0,l.useState)("");return(0,l.useEffect)(()=>{s&&n.length>0&&c(n[0].portion||"Regular")},[s,n]),(0,a.jsx)(w.lG,{open:s,onOpenChange:t,children:(0,a.jsxs)(w.Cf,{children:[(0,a.jsxs)(w.c7,{children:[(0,a.jsxs)(w.L3,{children:["Select Portion for ",i]}),(0,a.jsx)(w.rr,{children:"Choose a portion size to add to the order."})]}),(0,a.jsx)("div",{className:"py-4 flex justify-center",children:(0,a.jsx)(_.O,{type:"single",variant:"outline",value:d,onValueChange:e=>{e&&c(e)},className:"flex-wrap justify-center",children:n.map(e=>(0,a.jsxs)(_.d,{value:e.portion||"Regular",className:"gap-2",children:[(0,a.jsx)(L.A,{className:"h-4 w-4"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{children:e.portion}),(0,a.jsxs)("span",{className:"text-xs text-muted-foreground ml-2",children:["Rs.",e.rate.toFixed(2)]})]})]},e.id))})}),(0,a.jsxs)(w.Es,{children:[(0,a.jsx)(x.$,{variant:"outline",onClick:()=>t(!1),children:"Cancel"}),(0,a.jsx)(x.$,{onClick:()=>{d&&r(d)},disabled:!d,children:"Add to Order"})]})]})})}let B=e=>{let{currentPage:s,totalPages:t,onPrev:l,onNext:i}=e;return(0,a.jsxs)("div",{className:"flex justify-center items-center gap-4",children:[(0,a.jsxs)(x.$,{onClick:l,disabled:1===s,variant:"outline",children:[(0,a.jsx)($.A,{className:"h-4 w-4 mr-2"}),"Previous"]}),(0,a.jsxs)("span",{className:"text-sm font-medium",children:["Page ",s," of ",t]}),(0,a.jsxs)(x.$,{onClick:i,disabled:s===t,variant:"outline",children:["Next",(0,a.jsx)(M.A,{className:"h-4 w-4 ml-2"})]})]})};function J(e){let{menuItems:s,isLoading:t,onAddToOrder:i,selectedCategory:n}=e,[r,d]=(0,l.useState)(1),[c,o]=(0,l.useState)(null),{toast:m}=(0,A.dj)(),x=(0,l.useMemo)(()=>{if(!s)return[];let e=new Map;return s.forEach(s=>{let t=e.get(s.name);t||(t={name:s.name,category:s.category,baseRate:s.rate,portions:[]},e.set(s.name,t)),t.portions.push(s)}),Array.from(e.values())},[s]);(0,l.useEffect)(()=>{d(1)},[n]);let h=e=>{1===e.portions.length&&"Regular"===e.portions[0].portion?i(e.portions[0],e.portions[0].portion||"Regular"):o(e)},u="All"===n?x:x.filter(e=>e.category===n),p=Math.ceil(u.length/8),j=u.slice((r-1)*8,8*r),f=()=>{d(e=>Math.max(e-1,1))},g=()=>{d(e=>Math.min(e+1,p))};return t?(0,a.jsx)("div",{children:(0,a.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:Array.from({length:8}).map((e,s)=>(0,a.jsx)(V,{},s))})}):(0,a.jsxs)("div",{children:[c&&(0,a.jsx)(z,{isOpen:!!c,onOpenChange:e=>!e&&o(null),itemName:c.name,portions:c.portions,onConfirm:e=>{if(c){let s=c.portions.find(s=>s.portion===e);s&&i(s,s.portion||"Regular")}o(null)}}),0===u.length?(0,a.jsx)("div",{className:"text-center text-muted-foreground py-16 border-2 border-dashed rounded-lg",children:(0,a.jsx)("p",{children:"No menu items found for this category."})}):(0,a.jsxs)(a.Fragment,{children:[p>1&&(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsx)(B,{currentPage:r,totalPages:p,onPrev:f,onNext:g})}),(0,a.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:j.map(e=>(0,a.jsx)(I,{item:e,onAddToOrder:()=>h(e)},e.name))}),p>1&&(0,a.jsx)("div",{className:"mt-6",children:(0,a.jsx)(B,{currentPage:r,totalPages:p,onPrev:f,onNext:g})})]})]})}let V=()=>(0,a.jsxs)("div",{className:"flex flex-col space-y-3",children:[(0,a.jsx)(q.E,{className:"h-[125px] w-full rounded-xl"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(q.E,{className:"h-4 w-3/4"}),(0,a.jsx)(q.E,{className:"h-4 w-1/2"})]})]});var G=t(75074);function Z(e){let{selectedTable:s,onSelectTable:t,occupiedTables:l,tableCount:i}=e,n=Array.from({length:i},(e,s)=>s+1);return(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-3",children:"Select a Table"}),(0,a.jsx)("div",{className:"grid grid-cols-4 sm:grid-cols-6 md:grid-cols-8 gap-3",children:n.map(e=>{let i=s===e,n=l.includes(e)&&!i;return(0,a.jsxs)(h.Zp,{onClick:()=>t(e),className:(0,j.cn)("cursor-pointer transition-all duration-200 aspect-square flex items-center justify-center relative",i?"bg-primary text-primary-foreground shadow-lg ring-2 ring-primary ring-offset-2":n?"bg-amber-500/20 border-amber-500 text-amber-700":"hover:bg-muted/50"),children:[(0,a.jsx)(h.Wu,{className:"p-2",children:(0,a.jsxs)("span",{className:"font-bold text-lg",children:["T",e]})}),n&&(0,a.jsxs)("span",{className:"absolute -top-2 -right-2 flex h-4 w-4",children:[(0,a.jsx)("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-amber-400 opacity-75"}),(0,a.jsx)("span",{className:"relative inline-flex rounded-full h-4 w-4 bg-amber-500"})]})]},e)})})]})}var Q=t(91462),W=t(31554),K=t(18186),H=t(44558);function U(e){let{orders:s,onSelectOrder:t,activeOrderId:l}=e,i=e=>"delivery"===e.order_type?"Delivery #".concat(e.id.toString().slice(-4)):"Table ".concat(e.table_number);return 0===s.length?null:(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold mb-3 flex items-center gap-2",children:[(0,a.jsx)(Q.A,{className:"w-5 h-5"})," Active Orders"]}),(0,a.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3",children:s.map(e=>{let s=l===e.id;return(0,a.jsx)(h.Zp,{onClick:()=>t(e.id),className:(0,j.cn)("cursor-pointer transition-all duration-200 flex flex-col",s?"bg-primary text-primary-foreground shadow-lg ring-2 ring-primary ring-offset-2":"hover:bg-muted/50"),children:(0,a.jsxs)(h.Wu,{className:"p-3 flex flex-col justify-between h-full",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("p",{className:"font-bold",children:i(e)}),"dine-in"===e.order_type?(0,a.jsx)(d.A,{className:"w-4 h-4 text-muted-foreground"}):(0,a.jsx)(c.A,{className:"w-4 h-4 text-muted-foreground"})]}),"delivery"===e.order_type&&(e.phone_no||e.flat_no)&&(0,a.jsxs)("div",{className:"text-xs space-y-1 mb-2",children:[e.phone_no&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(W.A,{className:"w-3 h-3"}),(0,a.jsx)("span",{children:e.phone_no})]}),e.flat_no&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(K.A,{className:"w-3 h-3"}),(0,a.jsx)("span",{children:e.flat_no})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"text-sm space-y-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(H.A,{className:"w-3 h-3"}),(0,a.jsxs)("span",{children:[e.items.length," items"]})]}),(0,a.jsxs)("div",{className:"font-semibold",children:["Rs.",e.total.toFixed(2)]})]}),e.status&&(0,a.jsx)(T.E,{variant:"secondary",className:"capitalize mt-2",children:e.status})]})]})},e.id)})})]})}var Y=t(42099),X=t(62523),ee=t(85057);function es(e){let{isOpen:s,onOpenChange:t,order:i,onConfirm:n}=e,[r,d]=(0,l.useState)({phone_no:(null==i?void 0:i.phone_no)||"",flat_no:(null==i?void 0:i.flat_no)||"",building_no:(null==i?void 0:i.building_no)||"",address:(null==i?void 0:i.address)||""}),{toast:c}=(0,A.dj)(),o=e=>{d({...r,[e.target.id]:e.target.value})};return(0,a.jsx)(w.lG,{open:s,onOpenChange:t,children:(0,a.jsxs)(w.Cf,{children:[(0,a.jsxs)(w.c7,{children:[(0,a.jsx)(w.L3,{children:"Delivery Details"}),(0,a.jsx)(w.rr,{children:"Please enter the customer's delivery information."})]}),(0,a.jsxs)("div",{className:"space-y-4 py-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(ee.J,{htmlFor:"phone_no",children:"Phone Number"}),(0,a.jsx)(X.p,{id:"phone_no",value:r.phone_no,onChange:o,placeholder:"Customer's phone",required:!0})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(ee.J,{htmlFor:"flat_no",children:"Flat / Apt Number"}),(0,a.jsx)(X.p,{id:"flat_no",value:r.flat_no,onChange:o,placeholder:"e.g., 4B",required:!0})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(ee.J,{htmlFor:"building_no",children:"Building Name / Number (Optional)"}),(0,a.jsx)(X.p,{id:"building_no",value:r.building_no,onChange:o,placeholder:"e.g., Sunshine Apartments"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(ee.J,{htmlFor:"address",children:"Street Address (Optional)"}),(0,a.jsx)(X.p,{id:"address",value:r.address,onChange:o,placeholder:"e.g., 123 Main Street"})]})]}),(0,a.jsxs)(w.Es,{children:[(0,a.jsx)(x.$,{variant:"outline",onClick:()=>t(!1),children:"Cancel"}),(0,a.jsx)(x.$,{onClick:()=>{if(!r.phone_no||!r.flat_no)return void c({variant:"destructive",title:"Missing Information",description:"Phone number and Flat / Apt Number are required."});n(r),t(!1)},children:"Confirm Details"})]})]})})}function et(e){let{onAddItem:s}=e,[t,i]=(0,l.useState)(!1),[n,r]=(0,l.useState)(""),[d,c]=(0,l.useState)(""),{toast:o}=(0,A.dj)();return(0,a.jsxs)(w.lG,{open:t,onOpenChange:i,children:[(0,a.jsx)(w.zM,{asChild:!0,children:(0,a.jsxs)(x.$,{variant:"outline",children:[(0,a.jsx)(m.A,{className:"mr-2 h-4 w-4"}),"Add Custom Item"]})}),(0,a.jsxs)(w.Cf,{children:[(0,a.jsxs)(w.c7,{children:[(0,a.jsx)(w.L3,{children:"Add Custom Item"}),(0,a.jsx)(w.rr,{children:"Enter the details for the item that is not on the menu."})]}),(0,a.jsxs)("div",{className:"space-y-4 py-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(ee.J,{htmlFor:"item-name",children:"Item Name"}),(0,a.jsx)(X.p,{id:"item-name",value:n,onChange:e=>r(e.target.value),placeholder:"e.g., Special Request Pasta",required:!0})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(ee.J,{htmlFor:"item-rate",children:"Price (Rate)"}),(0,a.jsx)(X.p,{id:"item-rate",type:"number",value:d,onChange:e=>c(e.target.value),placeholder:"e.g., 15.00",required:!0})]})]}),(0,a.jsxs)(w.Es,{children:[(0,a.jsx)(x.$,{variant:"outline",onClick:()=>i(!1),children:"Cancel"}),(0,a.jsx)(x.$,{onClick:()=>{let e=parseFloat(d);if(!n.trim()||isNaN(e)||e<=0)return void o({variant:"destructive",title:"Invalid Input",description:"Please enter a valid item name and a positive price."});s(n,e),r(""),c(""),i(!1)},children:"Add to Order"})]})]})]})}var ea=t(29556);let el=()=>-Math.floor(1e6*Math.random());function ei(){let{menuItems:e,isMenuLoading:s,onRefreshMenu:t}=(0,ea.E)(),[n,r]=(0,l.useState)(null),[o,h]=(0,l.useState)([]),[u,p]=(0,l.useState)(!1),[j,f]=(0,l.useState)(!0),[g,v]=(0,l.useState)(null),[y,N]=(0,l.useState)(null),[b,w]=(0,l.useState)(!1),[C,S]=(0,l.useState)(""),O=(0,i.useRouter)(),{toast:k}=(0,A.dj)(),[P,R]=(0,l.useState)("Dine In"),[F,T]=(0,l.useState)(null),[D,I]=(0,l.useState)([]),[$,M]=(0,l.useState)("All"),L=(0,l.useMemo)(()=>{let s=e.filter(e=>e.is_active);return C&&(s=s.filter(e=>e.name.toLowerCase().includes(C.toLowerCase()))),s},[e,C]),z=(0,l.useCallback)(async e=>{f(!0);let[s,t]=await Promise.all([(0,Y.kf)(e),(0,Y.mt)(e)]);h(s),N(t),f(!1)},[]);(0,l.useEffect)(()=>{let e=localStorage.getItem("user");if(e){let s=JSON.parse(e);v(s),p(!0),s.restaurant_id&&z(s.restaurant_id)}else O.replace("/login")},[O,z]),(0,l.useEffect)(()=>{if(L&&L.length>0){let e=["All",...Array.from(new Set(L.map(e=>e.category).filter(Boolean)))];I(e),e.length>0&&!e.includes($)&&M("All")}},[L,$]);let B=o.filter(e=>"dine-in"===e.order_type&&e.table_number&&e.id>0).map(e=>e.table_number);(0,l.useEffect)(()=>{"dine-in"==("Dine In"===P?"dine-in":"delivery")&&(F?r(o.find(e=>e.table_number===F)||null):r(null))},[F,P,o]);let V=async e=>{let s=!e.id||e.id<0,t=n?{...n}:null;if(r(e),s?o.find(s=>s.id===e.id)||h(s=>[...s,e]):h(s=>s.map(s=>s.id===e.id?e:s)),"pending"===e.status)return e;let a=await (0,Y.EB)(e);return a?(r(a),h(s=>[...s.filter(s=>s.id!==e.id),a])):(k({variant:"destructive",title:"Error",description:"Failed to save order."}),t?(r(t),h(e=>e.map(e=>e.id===t.id?t:e))):(r(null),h(s=>s.filter(s=>s.id!==e.id)))),a},Q=async e=>{if(n&&"pending"===n.status){if("delivery"===n.order_type&&!e)return void w(!0);let s={...n,...e,status:"received"},t=await V(s);t&&(await (0,Y.fr)(t)?k({title:"Order Confirmed",description:"The order has been sent to the kitchen."}):k({variant:"destructive",title:"Kitchen Order Failed",description:"The order was confirmed but could not be sent to the kitchen. Please check system status."}))}},W=async(e,s)=>{let t;if(!(null==g?void 0:g.restaurant_id))return;let a="Dine In"===P?"dine-in":"delivery";if("dine-in"===a&&!F)return void k({variant:"destructive",title:"No table selected",description:"Please select a table before adding items to a Dine In order."});let l="".concat(e.id,"-").concat(s),i={...e,quantity:1,rate:Number(e.rate),portion:s};if(n){let e;e=n.items.find(e=>"".concat(e.id,"-").concat(e.portion)===l)?n.items.map(e=>"".concat(e.id,"-").concat(e.portion)===l?{...e,quantity:e.quantity+1}:e):[...n.items,i],t={...n,items:e}}else t={id:el(),items:[i],subtotal:0,tax:0,total:0,payment_status:"unpaid",order_type:a,table_number:"dine-in"===a?F:null,status:"pending",created_at:new Date().toISOString(),restaurant_id:g.restaurant_id};let r=t.items.reduce((e,s)=>e+s.rate*s.quantity,0),d=0;y&&y.tax_enabled&&(y.is_restaurant&&(y.cgst&&(d+=r*(y.cgst/100)),y.igst&&(d+=r*(y.igst/100))),y.is_bar&&y.vat&&(d+=r*(y.vat/100)));let c=r+d;t.subtotal=r,t.tax=d,t.total=c,await V(t)&&k({title:"Item Added",description:"".concat(e.name," (").concat(s,") was added to the order.")})},K=(e,s)=>{if(!n)return;let t="".concat(e,"-").concat(s),a=n.items.filter(e=>"".concat(e.id,"-").concat(e.portion)!==t);V({...n,items:a})},H=async()=>{if(n&&(null==g?void 0:g.restaurant_id)){if("pending"===n.status){r(null),h(e=>e.filter(e=>e.id!==n.id));return}if(n.id>0)return void(await (0,Y.o8)(n.id,g.restaurant_id)?(h(o.filter(e=>e.id!==n.id)),r(null),"dine-in"===n.order_type&&T(null),k({title:"Order Cleared",description:"The order has been removed."})):k({variant:"destructive",title:"Error",description:"Failed to clear order."}));await V({...n,items:[]})}},ee=async e=>{let s=await (0,Y.EB)({...e,payment_status:"paid"});return s?(k({title:"Payment Successful",description:"The order has been completed and saved to history."}),s):(k({variant:"destructive",title:"Error",description:"Failed to complete payment."}),null)};if(!u)return(0,a.jsx)("div",{className:"flex justify-center items-center h-screen",children:(0,a.jsx)("div",{className:"text-center",children:(0,a.jsx)("p",{children:"Loading..."})})});let ei=j||s;return(0,a.jsxs)("div",{className:"container mx-auto p-4 md:p-6 lg:p-8",children:[n&&"delivery"===n.order_type&&(0,a.jsx)(es,{isOpen:b,onOpenChange:w,order:n,onConfirm:e=>Q(e)}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 lg:gap-8",children:[(0,a.jsx)("div",{className:"lg:col-span-2",children:(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-3",children:"Create Order"}),(0,a.jsxs)("div",{className:"flex items-center gap-4 mb-6",children:[(0,a.jsxs)(_.O,{type:"single",value:P,onValueChange:e=>{e&&(R(e),T(null),r(null))},className:"bg-background rounded-lg p-1 border",children:[(0,a.jsxs)(_.d,{value:"Dine In",className:"gap-2 data-[state=on]:bg-primary data-[state=on]:text-primary-foreground",children:[(0,a.jsx)(d.A,{})," Dine In"]}),(0,a.jsxs)(_.d,{value:"Delivery",className:"gap-2 data-[state=on]:bg-primary data-[state=on]:text-primary-foreground",children:[(0,a.jsx)(c.A,{})," Delivery"]})]}),"Delivery"===P&&(0,a.jsxs)(x.$,{variant:"outline",onClick:()=>{r(null),T(null),R("Delivery")},children:[(0,a.jsx)(m.A,{className:"mr-2 h-4 w-4"}),"New Delivery"]})]}),u&&!ei&&o.length>0&&(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsx)(U,{orders:o.filter(e=>e.order_type===("Dine In"===P?"dine-in":"delivery")),onSelectOrder:e=>{let s=o.find(s=>s.id===e);s&&("dine-in"===s.order_type?(R("Dine In"),T(s.table_number||null)):(R("Delivery"),T(null)),r(s))},activeOrderId:null==n?void 0:n.id})}),"Dine In"===P&&(0,a.jsx)("div",{className:"mb-6",children:!u||ei?(0,a.jsxs)("div",{children:[(0,a.jsx)(q.E,{className:"h-8 w-48 mb-3"}),(0,a.jsx)("div",{className:"grid grid-cols-4 sm:grid-cols-6 md:grid-cols-8 gap-3",children:Array.from({length:12}).map((e,s)=>(0,a.jsx)(q.E,{className:"aspect-square"},s))})]}):(0,a.jsx)(Z,{selectedTable:F,onSelectTable:e=>{T(e),r(o.find(s=>s.table_number===e)||null)},occupiedTables:B,tableCount:(null==y?void 0:y.table_count)||12})}),(0,a.jsxs)("div",{className:"mb-6 space-y-4",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(G.A,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-muted-foreground"}),(0,a.jsx)(X.p,{placeholder:"Search for menu items...",className:"pl-10",value:C,onChange:e=>S(e.target.value)})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"Menu Categories"}),(0,a.jsx)(et,{onAddItem:(e,s)=>{if(null==g?void 0:g.restaurant_id){if("dine-in"==("Dine In"===P?"dine-in":"delivery")&&!F)return void k({variant:"destructive",title:"No table selected",description:"Please select a table before adding items for a Dine In order."});W({id:el(),name:e,rate:s,category:"Custom",portion:"Custom",is_active:!0,restaurant_id:g.restaurant_id},"Custom")}}})]}),(0,a.jsx)(_.O,{type:"single",value:$,onValueChange:e=>{e&&M(e)},className:"flex-wrap justify-start",children:s?(0,a.jsx)(q.E,{className:"h-9 w-full"}):D.map(e=>(0,a.jsx)(_.d,{value:e,children:e},e))})]}),(0,a.jsx)(J,{menuItems:L,isLoading:s,onAddToOrder:W,selectedCategory:$})]})}),(0,a.jsx)("div",{className:"mt-8 lg:mt-0",children:(0,a.jsx)(E,{order:n,settings:y,onUpdateQuantity:(e,s,t)=>{if(!n)return;let a="".concat(e,"-").concat(s);if(t<=0)K(e,s);else{let e=n.items.map(e=>"".concat(e.id,"-").concat(e.portion)===a?{...e,quantity:t}:e);V({...n,items:e})}},onRemoveItem:K,onClearOrder:H,onCompleteOrder:ee,onConfirmOrder:()=>Q(),onNewOrder:()=>{r(null),T(null),R("Dine In"),(null==g?void 0:g.restaurant_id)&&z(g.restaurant_id)}})})]})]})}},32751:(e,s,t)=>{Promise.resolve().then(t.bind(t,181))}},e=>{var s=s=>e(e.s=s);e.O(0,[908,881,722,67,766,710,356,441,684,358],()=>s(32751)),_N_E=e.O()}]);